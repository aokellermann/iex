version: 2

jobs:
  build:
    docker:
      - image: aokellermann/iex:ci
        auth:
          username: aokellermann
          password: $DOCKERHUB_PASSWORD
    steps:
      - checkout
      - run:
          name: Style
          command: ./style.sh
      - run:
          name: Configure
          command: |
            rm -rf build
            mkdir build
            cd build
            cmake -DCMAKE_BUILD_TYPE=Debug -DIEX_BUILD_DOCUMENTATION:BOOL=ON -DIEX_ENABLE_ALLWARNINGS:BOOL=ON -DIEX_BUILD_TESTING:BOOL=ON ..
      - run:
          name: Compile
          command: cmake --build build/
      - run:
          name: Unit Test
          command: ././build/iex/test/unit_test
